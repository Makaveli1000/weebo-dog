# netlify.toml

[build]
  # CRITICAL: Executes the script to create env-config.js and then installs dependencies.
  # The '&& npm install' is crucial for installing the Node.js functions dependency.
  command = "./create-config.sh && npm install" 
  
  # Directory where Netlify finds the deploy-ready files (index.html is here).
  publish = "/" 
  
  # Directory where Netlify finds serverless function code.
  functions = "netlify/functions"

  # SECURITY: Environment configuration block
  environment = {
    # This disables Netlify's secret scanner for the public Firebase keys written to env-config.js.
    SECRETS_SCAN_SMART_DETECTION_ENABLED = "false"
  }

# ---------------------------------------------------------------------------------
# SINGLE PAGE APPLICATION (SPA) REDIRECTS (Crucial for client-side routing)
# ---------------------------------------------------------------------------------

[[redirects]]
  # This rule ensures that any request not matching a static file is served index.html.
  from = "/*"
  to = "/index.html"
  status = 200