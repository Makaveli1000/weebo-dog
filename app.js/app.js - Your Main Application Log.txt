// --- ATTACH EVENT LISTENERS (Final Fix for Dead Buttons) ---
function attachEventListeners() {
    if (!document.body) return; // Wait for the body to exist

    // Helper function for listener attachment
    const attach = (id, handler) => {
        const el = document.getElementById(id);
        if (el) {
            el.addEventListener('click', handler);
            // Console logging removed for cleaner production code
        } else {
             // Console logging for missing elements removed for cleaner production code
        }
    };
    
    // 1. Header Buttons
    attach('header-auth-btn', () => window.toggleLoginModal(true));
    attach('account-btn', () => window.toggleAccountModal(true));
    attach('admin-btn', () => window.toggleAdminModal(true));
    
    // 2. Paywall/Upgrade
    attach('upgrade-btn', () => window.toggleCashAppModal(true));
    
    // 3. Login/Register Modal
    attach('login-auth-btn', window.logIn);
    attach('register-auth-btn', window.register);
    attach('close-login-modal-btn', () => window.toggleLoginModal(false));
    
    // 4. Account Modal
    attach('logout-btn', window.logOut);
    attach('save-nickname-btn', window.saveAccountNickname);
    attach('update-password-btn', window.updateUserPassword);
    attach('close-account-modal-btn', () => window.toggleAccountModal(false));

    // 5. CashApp Modal
    attach('simulate-payment-btn', window.simulatePaymentSuccess);
    attach('close-cashapp-modal-btn', () => window.toggleCashAppModal(false));
    
    // 6. Data Submission Modals
    attach('submit-data-modal-btn', () => window.toggleSportsDataModal(true));
    attach('close-sports-data-modal-btn', () => window.toggleSportsDataModal(false));
    
    // 7. Cheerleader Feature
    attach('cheerleader-upload-btn-trigger', () => window.toggleCheerleaderUploadModal(true));
    attach('submit-cheer-btn', window.submitCheerleaderContent);
    attach('close-cheerleader-upload-modal-btn', () => window.toggleCheerleaderUploadModal(false));

    // 8. Locker Room
    attach('locker-upload-btn', window.handleFileUpload);
    // Note: media-file-input uses onchange="handleFileUpload()" in HTML
    
    // 9. Sidebar Toggles
    attach('mode-active-btn', () => window.toggleSidebarMode('ACTIVE'));
    attach('mode-leaderboard-btn', () => window.toggleSidebarMode('LEADERBOARD'));
    
    // 10. Chat/Data Buttons
    attach('send-message-btn', () => window.sendMessage('text'));
    attach('video-call-btn', () => window.sendMessage('VIDEO_REQUEST', 'Video call request'));
    
    // 11. Copy/Zeus
    attach('copy-qr-btn', window.copyQrCodeText);
    attach('narrator-launch-btn', window.startZeusNarratorTour);
}


// --- RUN SEQUENCE ---

document.addEventListener('DOMContentLoaded', () => {
    cacheDOMElements(); 
    attachEventListeners(); // <-- CRITICAL: The function is called here!

    // ... (Rest of DOMContentLoaded logic)
});